<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIONOR Chat</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0e0f11;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      position: fixed;
      top: 0;
      width: 96%;
      background: #1a1d24;
      padding: 16px;
      text-align: center;
      font-size: 1.4em;
      color: #00ffe7;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      z-index: 10;
    }

    #chat {
      flex: 1;
      padding: 90px 20px 100px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .msg {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .user {
      align-self: flex-end;
      background: #00ffe7;
      color: #10131a;
    }

    .ai {
      align-self: flex-start;
      background: #20242f;
    }

    #input-area {
      position: fixed;
      bottom: 0;
      width: 96%;
      display: flex;
      padding: 15px;
      background: #16181f;
      border-top: 1px solid #333;
      z-index: 10;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #252932;
      color: #fff;
      font-size: 1em;
    }

    button {
      margin-left: 10px;
      padding: 12px 20px;
      background-color: #00ffe7;
      color: #10131a;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #00d1bf;
    }
  </style>
</head>
<body>
  <header>LIONOR3 AI Chat</header>

  <div id="chat"></div>

  <div id="input-area">
    <input type="text" id="pertanyaan" placeholder="Tulis pesan..." />
    <button onclick="kirimPertanyaan()">Kirim</button>
  </div>

  <script>
  // === AUTO REPLY MANUAL ===
  const autoReply = (q) => {
    const pertanyaan = q.toLowerCase().trim();

    if (pertanyaan === "siapa pemilik lionor ai") {
      return "Lionor AI adalah produk hasil karya seorang kreator dan programmer yang berdedikasi untuk menghadirkan asisten digital yang cerdas dan membantu banyak orang dalam berbagai kebutuhan sehari-hari.";
    }

    if (pertanyaan === "lionor ai dari mana") {
      return "Lionor AI dikembangkan di Indonesia dengan tujuan menciptakan teknologi yang mudah diakses dan bermanfaat bagi pengguna di seluruh dunia, terutama yang menggunakan bahasa Indonesia.";
    }

    if (pertanyaan === "apa visi misi lionor ai") {
      return "Visi Lionor AI adalah menjadi asisten pintar yang dapat diandalkan kapan saja, dengan misi menyediakan pengalaman berinteraksi yang menyenangkan, berguna, dan mudah diakses oleh semua kalangan.";
    }

    if (pertanyaan === "siapa zezy") {
      return "Zezy adalah sosok kreatif dan programmer yang berada di balik pengembangan Lionor AI, dengan semangat tinggi untuk membuat teknologi yang tidak hanya canggih tetapi juga ramah dan membantu banyak orang.";
    }

    if (pertanyaan === "hallo lionor" || pertanyaan === "halo lionor") {
      return "Hallo juga! Ada yang mau kamu tanyain hari ini?";
    }

    if (pertanyaan.includes("siapa kamu")) {
      return "Aku Lionor AI Beta, asisten digital yang siap membantu kamu kapan saja!";
    }

    if (pertanyaan.includes("makasih") || pertanyaan.includes("terima kasih")) {
      return "Sama-sama yaa, aku senang bisa bantu 😊";
    }

    return null;
  };

// === BATAS PERTANYAAN HARIAN ===
let jumlahPertanyaan = parseInt(localStorage.getItem('jumlahPertanyaan') || '0');
const LIMIT_HARIAN = 7;

// === EFEK KETIK ===
function ketikEfek(element, text, delay = 20) {
  let i = 0;
  element.textContent = '';
  function ketik() {
    if (i < text.length) {
      element.textContent += text.charAt(i);
      i++;
      setTimeout(ketik, delay);
    }
  }
  ketik();
}

// === POPUP PREMIUM ===
function tampilkanPopupPembayaran() {
  const popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '0';
  popup.style.left = '0';
  popup.style.width = '100vw';
  popup.style.height = '100vh';
  popup.style.background = 'rgba(0,0,0,0.8)';
  popup.style.display = 'flex';
  popup.style.justifyContent = 'center';
  popup.style.alignItems = 'center';
  popup.style.zIndex = '9999';

  popup.innerHTML = `
    <div style="background:#1e1f22;padding:25px;border-radius:10px;color:white;width:320px;max-width:90%;text-align:center">
      <h3 style="margin-top:0;margin-bottom:15px;">🚀 Lionor AI Premium</h3>
      <p>✅ 100 pertanyaan per hari<br>✅ Akses dari 3 website:<br>- Zestore.id<br>- VCSignalTrading.id<br>- Zeetrading.id<br>✅ Dapat update fitur lebih awal</p>
      <p><strong>Harga:</strong> Rp151.500<br><small>(QRIS Dana + 1% admin)</small></p>
      <img src="https://i.ibb.co/jzGHtXj/qris.jpg" alt="QRIS" style="width:100%;margin:10px 0;border-radius:10px;" />
      <input id="namaUser" placeholder="Nama Lengkap" style="width:100%;margin-bottom:8px;padding:8px;" />
      <input id="emailUser" placeholder="Email" style="width:100%;margin-bottom:8px;padding:8px;" />
      <input id="waUser" placeholder="Nomor WhatsApp" style="width:100%;margin-bottom:10px;padding:8px;" />
      <button id="tombolBayar" onclick="prosesPembayaran()" style="width:100%;padding:10px;background:#00ffe7;color:#10131a;font-weight:bold;border:none;border-radius:5px;">✅ Sudah Bayar</button>
    </div>
  `;
  document.body.appendChild(popup);
}

function prosesPembayaran() {
  const tombol = document.getElementById('tombolBayar');
  const nama = document.getElementById('namaUser').value;
  const email = document.getElementById('emailUser').value;
  const wa = document.getElementById('waUser').value;

  if (!nama || !email || !wa) {
    alert("Lengkapi semua data dulu ya.");
    return;
  }

  tombol.disabled = true;
  tombol.textContent = "⏳ Mengirim...";

  const teks = `Halo admin Lionor AI, saya sudah bayar.\n\nNama: ${nama}\nEmail: ${email}\nWhatsApp: ${wa}\n\nMohon aktifkan Lionor Premium.`;
  const url = `https://wa.me/62XXXXXXXXXX?text=${encodeURIComponent(teks)}`;

  setTimeout(() => {
    localStorage.setItem('jumlahPertanyaan', 0); // Reset
    window.location.href = url;
    tombol.disabled = false;
    tombol.textContent = "✅ Sudah Bayar";
  }, 10000); // cooldown 10 detik
}

// === BALASAN OTOMATIS SINGKAT (DUMMY) ===
function autoReply(teks) {
  const t = teks.toLowerCase();
  if (t.includes("siapa kamu")) return "Saya Lionor, AI asisten kamu 🌌";
  if (t.includes("website kamu")) return "Bisa cek di: zetore.id, vcsignaltrading.id, dan zeetrading.id ✨";
  return null;
}

// === KIRIM PERTANYAAN KE CHATBOX ===
async function kirimPertanyaan() {
  const input = document.getElementById('pertanyaan');
  const chat = document.getElementById('chat');
  const teks = input.value.trim();

  if (!teks) return;

  if (jumlahPertanyaan >= LIMIT_HARIAN) {
    const aiMsg = document.createElement('div');
    aiMsg.className = 'msg ai';
    chat.appendChild(aiMsg);
    ketikEfek(aiMsg, "⚠️ Anda telah melebihi batas harian. Silakan upgrade ke Lionor AI Premium.");
    tampilkanPopupPembayaran();
    return;
  }

  jumlahPertanyaan++;
  localStorage.setItem('jumlahPertanyaan', jumlahPertanyaan);

  const userMsg = document.createElement('div');
  userMsg.className = 'msg user';
  userMsg.textContent = teks;
  chat.appendChild(userMsg);

  input.value = '';
  input.focus();

  const aiMsg = document.createElement('div');
  aiMsg.className = 'msg ai';
  chat.appendChild(aiMsg);
  chat.scrollTop = chat.scrollHeight;

  const jawabanCepat = autoReply(teks);
  if (jawabanCepat) {
    ketikEfek(aiMsg, jawabanCepat);
    return;
  }

  ketikEfek(aiMsg, '⏳ Lionor mikir...');

  try {
    const res = await fetch(`/.netlify/functions/ask?q=${encodeURIComponent(teks)}`);
    const data = await res.json();
    ketikEfek(aiMsg, data.answer || "⚠️ Lionor gak ngerti. Coba tanya dengan cara lain ya.");
  } catch (err) {
    ketikEfek(aiMsg, "⚠️ Gagal ambil jawaban. Cek koneksi atau backend-nya.");
  }

  chat.scrollTop = chat.scrollHeight;
}

// === LISTENER ENTER DENGAN DOMContentLoaded ===
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('pertanyaan').addEventListener('keydown', function (e) {
    if (e.key === 'Enter') kirimPertanyaan();
  });
});
</script>
</body>
</html>
